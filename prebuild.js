import fs from 'fs/promises'

const tasks = [
  { report: 'reports/allure/index.html', src: 'src/report_allure.ts', name: 'allureReport' },
  { report: 'reports/html/index.html', src: 'src/report_listing.ts', name: 'listingReport' },
  { report: 'reports/html/latest.html', src: 'src/report_latest.ts', name: 'latestReport' },
]

const buildString = (name, report) => [
  '// autogenerated',
  `export const ${name} = Buffer.from(`,
  `    '${report}',`,
  "    'base64'",
  ')',
  '',
]

for (const t of tasks) {
  const report = await fs.readFile(t.report)
  const data = buildString(t.name, report.toString('base64'))
  await fs.writeFile(t.src, data.join('\n'))
}
